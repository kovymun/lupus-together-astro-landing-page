---
// RESPONSIVE NAV
import { Icon } from "astro-icon/components";
---

<nav class="navbar" id="navbar">
  <a href="#hero" class="brand-logo">
    <Icon name="heart" size={20} />
    <span class="navbar-brand">Lupus Together</span>
  </a>

  <ul class="navbar-links">
    <li><a class="navlink" href="#about">About</a></li>
    <li><a class="navlink" href="#lupus">Understanding Lupus</a></li>
    <li><a class="navlink" href="#stories">Stories</a></li>
    <li><a class="navlink" href="#members">Meet the Team</a></li>
    <li><a class="navlink" href="#join">Get Involved</a></li>
  </ul>

  <div class="navbar-phone-btn">
    <div class="default-text">Contact Us</div>
    <div class="hover-text">011-456-7890</div>
  </div>

  <button class="navbar-toggle" aria-label="Toggle navigation">
    <Icon name="bars" size={24} />
  </button>

  <div id="mobile-nav-overlay" class="mobile-nav-overlay"></div>
</nav>

<!-- Navbar CSS Styles -->
<style>
  :root {
    --primary-color: #7b6cf6;
    --secondary-color: #d69585;
    --background-color: #faf8fc;
    --text-color: #333333;
    --primary-font-family: "Quicksand", sans-serif;
    --secondary-font-family: "Playfair Display", Georgia;
  }

  /* Navbar Base Styles */
  .navbar {
    position: fixed;
    top: 0;
    width: 100%;
    background: var(--background-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 2rem;
    z-index: 5;
  }

  .navbar-scrolled {
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }

  .navbar-brand {
    font-weight: bold;
    font-size: 1.2rem;
    color: var(--primary-color);
  }

  .brand-logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--primary-color);
    cursor: pointer;
    text-decoration: none;
  }

  .navbar-links {
    list-style: none;
    display: flex;
    gap: 3rem;
  }

  .navbar-links a {
    text-decoration: none;
    color: var(--text-color);
    font-weight: 500;
    position: relative;
  }

  .navbar-cta {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 0.6rem 1rem;
    border-radius: 5px;
    cursor: pointer;
  }
  .navbar-phone-btn {
    position: relative;
    background-color: var(--primary-color);
    color: #ffffff;
    padding: 0.6rem 1.2rem;
    border: none;
    cursor: pointer;
    font-weight: bold;
    font-size: 1rem;
    border-radius: 5px;
    overflow: hidden;
    transition: background-color 400ms ease;
  }

  .navbar-phone-btn .hover-text,
  .navbar-phone-btn .default-text {
    display: block;
    width: 100%;
    text-align: center;
    transition: all 400ms ease;
  }

  .navbar-phone-btn .hover-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.95);
    opacity: 0;
    pointer-events: none;
  }

  .navbar-phone-btn:hover .hover-text {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }

  .navbar-phone-btn:hover .default-text {
    opacity: 0;
  }

  /* Hamburger Hidden by Default */
  .navbar-toggle {
    display: none;
    color: var(--primary-color);
  }

  .navbar-toggle:active {
    transform: scale(0.95);
    transition: transform 100ms ease-in-out;
  }

  /* Mobile Nav Overlay */

  .mobile-nav-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.2);
    z-index: 4;
    animation: fadeIn 300ms ease forwards;
  }

  .mobile-nav-overlay.active {
    display: block;
  }

  /* Animations */
  @keyframes slideDown {
    0% {
      opacity: 0;
      transform: translateY(-10px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slideIn {
    0% {
      opacity: 0;
      transform: translateX(20px);
    }
    100% {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  /* Responsive Mobile Styles */
  @media (max-width: 1100px) {
    .navbar {
      padding: 1rem;
    }

    .navbar-links {
      position: fixed;
      top: 0;
      right: -100%;
      height: 100vh;
      width: 75%;
      max-width: 300px;
      flex-direction: column;
      justify-content: center;
      background-color: white;
      gap: 2rem;
      padding: 2rem;
      transition: right 300ms ease;
      box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
      z-index: 6;
    }

    .navbar-links.mobile-nav-active {
      right: 0;
    }

    .navbar-links.mobile-nav-active li {
      opacity: 0;
      animation: slideIn 300ms ease forwards;
    }

    .navbar-links.mobile-nav-active li:nth-child(1) {
      animation-delay: 100ms;
    }
    .navbar-links.mobile-nav-active li:nth-child(2) {
      animation-delay: 200ms;
    }
    .navbar-links.mobile-nav-active li:nth-child(3) {
      animation-delay: 300ms;
    }

    .navbar-links.mobile-nav-active li:nth-child(4) {
      animation-delay: 400ms;
    }

    .navbar-links.mobile-nav-active li:nth-child(5) {
      animation-delay: 500ms;
    }

    .navbar-phone-btn {
      display: none;
    }

    .navbar-toggle {
      display: block;
      background: none;
      border: none;
      z-index: 10;
    }

    .navbar-links .active {
      font-weight: normal;
      color: inherit;
      border-bottom: none;
    }
  }

  /* Larger screen styling */

  @media screen and (min-width: 1100px) {
    .navlink::after {
      content: "";
      position: absolute;
      height: 3px;
      width: 100%;
      background-color: var(--secondary-color);
      left: 0;
      bottom: -8px; /* Position below the text */
      transform: scaleX(0); /* Hidden by default */
      transform-origin: bottom right; /* Grows from right */
      transition: transform 0.3s linear;
    }

    /* Hover effect */
    .navlink:hover::after,
    .navlink.active::after {
      transform-origin: bottom left; /* Grows from left on hover */
      transform: scaleX(1); /* Fully visible */
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const body = document.body;
    const navbarElement: HTMLElement | null = document.getElementById("navbar");

    let isNavbarScrolled: boolean = false;

    const handleScrollEffect = (): void => {
      // Determine if the page is currently scrolled
      const scrolledNow: boolean = window.scrollY > 0;

      // Only proceed if the navbar element exists AND the scroll values has changed
      if (navbarElement && scrolledNow !== isNavbarScrolled) {
        isNavbarScrolled = scrolledNow; // Update tracking variable

        if (scrolledNow) {
          // if scrolled, add the class
          navbarElement.classList.add("navbar-scrolled");
        } else {
          // if not scrolled, remove the class
          navbarElement.classList.remove("navbar-scrolled");
        }
      }
    };

    handleScrollEffect();

    /* -- MOBILE NAV-MENU TOGGLE -- */

    const menuToggleButton: HTMLElement | null =
      document.querySelector(".navbar-toggle");
    const navbarLinks: HTMLElement | null =
      document.querySelector(".navbar-links");
    const mobileNavOverlay: HTMLElement | null =
      document.getElementById("mobile-nav-overlay");
    const navLinks: NodeListOf<HTMLAnchorElement> =
      document.querySelectorAll(".navbar-links a");

    // Single function to toggle the mobile menu state
    const toggleMenu = (): void => {
      navbarLinks?.classList.toggle("mobile-nav-active");
      mobileNavOverlay?.classList.toggle("active");
      // Prevent scrolling when the menu is open
      body.classList.toggle("no-scroll");
    };

    menuToggleButton?.addEventListener("click", toggleMenu);
    mobileNavOverlay?.addEventListener("click", toggleMenu);

    // Loop through each navigation link to close the menu when it's clicked
    navLinks.forEach((link: HTMLAnchorElement) => {
      link.addEventListener("click", () => {
        // Close the mobile menu when a link is clicked
        if (navbarLinks?.classList.contains("mobile-nav-active")) {
          toggleMenu();
        }
      });
    });

    /* -- ACTIVE NAVLINK -- */
    const navLink: NodeListOf<HTMLAnchorElement> =
      document.querySelectorAll(".navlink");

    const setActiveLink = (): void => {
      // Get the current URL hash (e.g., "#about" | #members)
      const currentHash: string = window.location.hash;

      // Remove the 'active' class from all links first
      navLink.forEach((link: HTMLAnchorElement) => {
        link.classList.remove("active");
      });

      // Find the link that matches the current hash and add the 'active' class
      if (currentHash) {
        const activeLink: HTMLAnchorElement | null = document.querySelector(
          `.navlink[href="${currentHash}"]`
        );
        if (activeLink) {
          activeLink.classList.add("active");
        }
      }
    };

    // Handle active class for links based on scroll position
    /** @type {NodeListOf<HTMLElement>} */
    const sections: NodeListOf<HTMLElement> =
      document.querySelectorAll("section[id]");

    // Function to handle the scroll event
    const handleScroll = () => {
      /** @type {string | null} */
      let currentActiveLink: string | null = null;

      // Determine which section is currently in view
      sections.forEach((section) => {
        /** @type {HTMLElement} **/
        const sec: HTMLElement = section as HTMLElement;
        const sectionTop: number = sec.offsetTop - 90; // Offset for fixed header
        const sectionBottom: number = sectionTop + sec.offsetHeight;

        if (window.scrollY >= sectionTop && window.scrollY < sectionBottom) {
          currentActiveLink = sec.id;
        }
      });

      // Remove the 'active' class from all links
      navLinks.forEach((link: HTMLAnchorElement) => {
        link.classList.remove("active");
      });

      // Add the 'active' class to the corresponding link
      if (currentActiveLink) {
        const activeLink: HTMLAnchorElement | null = document.querySelector(
          `.navlink[href="#${currentActiveLink}"]`
        );
        if (activeLink) {
          activeLink.classList.add("active");
        }
      }
    };

    // Add the scroll event listener to the window
    window.addEventListener("scroll", handleScroll);

    // Event listeners to update the active link
    window.addEventListener("hashchange", setActiveLink);
    window.addEventListener("scroll", handleScrollEffect, { passive: true });
  });
</script>
